<script>
  const phrasesContainer = document.getElementById('phrases');
  const columns = document.querySelectorAll('.column');
  let draggedItem = null;
  let cloneItem = null;

  // Mouse drag support (desktop)
  function enableDragEvents(element) {
    element.addEventListener('dragstart', (e) => {
      draggedItem = e.target;
      e.dataTransfer.effectAllowed = 'move';
      setTimeout(() => (e.target.style.display = 'none'), 0);
    });

    element.addEventListener('dragend', (e) => {
      e.target.style.display = 'block';
      draggedItem = null;
    });
  }

  document.querySelectorAll('.phrase').forEach(enableDragEvents);

  // Touch drag support (mobile/tablet)
  document.querySelectorAll('.phrase').forEach(item => {
    item.addEventListener('touchstart', (e) => {
      draggedItem = item;
      cloneItem = item.cloneNode(true);
      cloneItem.style.position = 'fixed';
      cloneItem.style.pointerEvents = 'none';
      cloneItem.style.opacity = '0.7';
      cloneItem.style.zIndex = '9999';
      document.body.appendChild(cloneItem);
    });

    item.addEventListener('touchmove', (e) => {
      const touch = e.touches[0];
      cloneItem.style.left = touch.clientX + 'px';
      cloneItem.style.top = touch.clientY + 'px';
    });

    item.addEventListener('touchend', (e) => {
      document.body.removeChild(cloneItem);
      cloneItem = null;

      const touch = e.changedTouches[0];
      const element = document.elementFromPoint(touch.clientX, touch.clientY);

      let dropColumn = element.closest('.column');
      if (dropColumn) {
        dropColumn.appendChild(draggedItem);
      }
      draggedItem = null;
    });
  });

  // Desktop drop highlight / drop
  columns.forEach(column => {
    column.addEventListener('dragover', e => {
      e.preventDefault();
      column.classList.add('highlight');
    });

    column.addEventListener('dragleave', () => {
      column.classList.remove('highlight');
    });

    column.addEventListener('drop', () => {
      column.classList.remove('highlight');
      if (draggedItem) {
        column.appendChild(draggedItem);
      }
    });
  });

  // Reset game
  document.getElementById('reset').addEventListener('click', () => {
    document.querySelectorAll('.phrase').forEach(p => phrasesContainer.appendChild(p));
  });
</script>
